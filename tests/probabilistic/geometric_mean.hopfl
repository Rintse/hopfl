# Samples the geometric series
# Free variables to pass through the environment:
#   p:  The coinflip threshold
# Example run:
#   stack run ghopfl-exe -- -v -E -n 3 -e "p<-0.5;count<-5" 
#   -d "0.6;0.7;0.8;0.1;0.6;0.1;0.7;0.9;0.2;0.4;0.8;0.3" 
#   -i tests/probabilistic/geometric_mean.hopfl 

let
   # Performs a flip until a value below p is reached
    geometric ← ( ( fix f . λ n . λ p . 
        if ( rand < p )
            then n
            else prevI ( f ⊙ next ( n + 1 ) ⊙ next p )
    ) 0 ) ;
   
    sample_list ← ( fix f . λ p . λ sample_count .
        if ( sample_count = 0 )
            then []
            else cons ( geometric p ) prevI ( 
                f ⊙ next p ⊙ next ( sample_count - 1 ) 
            )
    ) ;

    list_avg ← ( λ l . 
        ( foldl add 0 l ) / length l
    ) ;

in: list_avg ( sample_list p count )
