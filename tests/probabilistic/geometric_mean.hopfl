# Samples the geometric series
# Free variables to pass through the environment:
#   p:  The coinflip threshold
# Example run:
#   stack run ghopfl-exe -- -v -E -n 4 -e "p<-0.5" -d "0.6;0.7;0.8;0.1;0.6;0.1;0.7;0.9;0.2;0.4;0.8;0.3" -i tests/probabilistic/geometric_mean.hopfl 

let
    # Performs a flip until a value below p is reached
    geometric ← ( ( fix f . λ n . λ p . 
        if ( rand < p )
            then in ( inL n )
            else in ( inR ( f ⊙ next ( n + 1 ) ⊙ next p ) )
    ) 0 ) ;
  
    # Computes the average of a list of partial results
    list_avg ← ( λ l . 
        ( partial_func2 divide )
            ( foldl ( partial_func2 add ) ( partial_now 0 ) l ) # Sum of list
            ( partial_now ( length l ) )
    ) ;

    sample_list ← ( [geometric p, geometric p, geometric p, geometric p, geometric p] ) ;

in: list_avg sample_list 
