# Samples the geometric series
# Free variables to pass through the environment:
#   p:  The coinflip threshold

let
    # Extracts the computed value from the coproduct
    extract ← ( 
        fix f . λ x . match (out x) {
            left -> left; 
            right -> f ⊙ right
        } 
    );

   # Performs a flip until a value below p is reached
    geometric ← ( 
        λ p . ( ( fix f . λ n . if ( ( normal [0.5, 0.25] ) < p)
            then in ( inL n )
            else in ( inR ( f ⊙ next ( n + 1.0 ) ) ) ) 0.0 )
    )

# Result will be inside of next guards
in: extract (geometric p)
